## Error de size de script en php 

Existe un modal sobre el cual se tienen filtros de fechas y otros dos correspondientes a dos columnas de la misma tabla. Se tiene un botón dentro del modal para generar un archivo *.xlsx* que luego se descarga.
Las condiciones hasta el momento son las siguientes: 
* Si la consulta encuentra resultados, automáticamente comienza la descarga del *.xlsx*; y si no hay resultados de la consulta, sobre el modal se muestra un mensaje de error sobre el mismo modal mencionando que no hay resultados. 
* El archivo *.xlsx* es generado por una librería externa -> PHPExcel (http://www.codeplex.com/PHPExcel)

### Problema 
En ciertos casos donde 'si deberían existir' resultados, aparece el mensaje de que no existen resultados, se reportan mostrando q si se achica el rango de fechas, si aparecen resultados, mientras que si se amplía ya dejan de aparecer, algo ilógico.

* Luego de no lograr replicar el inconvieniente de manera local, se solicita una copia de la tabla donde si se produce el error, comprobándose la diferencia de cantidad de registros entre local y donde ocurre el error
* Se comprueba que el error es producido por la librería de excel, arrojando ``` Allowed memory size of NUMBER bytes exhausted (tried to allocate NUMBER bytes) ```
### Posible solución
* Se plantean posibles soluciones, entre ellas aumentar la cantidad de memoria asignada a un script modificando *memory_limit* en *php.ini*. Sin embargo, debido a que existen muchos servidores usando estos servicios, se haría imposible modificar uno por uno su *php.ini*. Sin embargo, se prueba su modificación, que da lugar a un nuevo error, ahora debido al tiempo de ejecución de un script (por defecto en php es de 30 segs como máximo), por lo cual habría que modificar también dicho valor en *php.ini*

### Solución 
* Se plantea como solución por lo tanto paginar el *.xlsx* recibido. Se setea un límite de estudios a colocar en cada archivo *.xlsx*, configurable por el usuario pero seteado por defecto en 1000. Luego, para la acción se crea una función para devolver la cantidad de registros a procesar, la cual se llama primero al presionar para generar el archivo. Una vez que la función responde con los registros encontrados, sobre el cliente se busca el valor de cantidad de registros por cada archivo, y luego se llama la función de descargar los archivos. Sin embargo, ahora el cliente envía además valor de inicio y fin de registros; y la función de descarga usa dicho valores para colocar los ``` LIMIT ``` de la consulta. El cliente enviará tantas peticiones modificando los límites como sea necesario según límite de registros por estudios. Finalmente, el servidor irá devolviendo los archivos a medida que vaya procesando. 
* Aunque no sea demasiando ortodoxa la función, permite que el cliente manipule y procese los límites de la consultas, quitándole esta tarea al servidor. Además como cada descarga de archivo será una petición indpendiente de las demás, permite que si se produzca error sobre una petición solo falle la descarga de ese archivo y no de todo el proceso, haciendo posible que los demás archivos no se vean afectados. También se manipula en el cliente el error de descarga, de tal forma que si existe un error se muestre éste y no del por defecto que no existen registros. 
* Se comprueba que la solución optada a veces se demora, por lo cual se ofrece una nueva alternativa la cual consiste en devolver un archivo *.csv*. Dicha opción será elegible por un *checkbox* en el modal. La misma usa *fputcsv*, escribe sobre *php://output* y crea los *headers* para generar el archivo. Finalmente el cliente apunta a ese recurso y lo descarga. A diferencia del caso en *.xlsx*, la petición para descargar el archivo aquí se hace con ``` GET ```, por lo cual los parámetros se colocan sobre la *url* cifrados. Esta opción no devolvió errores de memoria con grandes volúmenes de datos, e incluso fue significativamente veloz sobre la de uso de la librería